---
  - name: Install Docker on the Server
    hosts: 35.208.19.30
    become: yes
    become_user: root
    tasks:
      - name:  Add Puppet to your CentOS repository list
        shell: "rpm -ivh https://yum.puppetlabs.com/el/7/products/x86_64/puppetlabs-release-7-11.noarch.rpm"
      - name: Installing puppet agent
        shell: "sudo yum install puppet-agent"
        
      - name: Configure Puppet Agent
        shell: "source /etc/profile.d/puppet-agent.sh && export PATH=/opt/puppetlabs/bin:$PATH"
         
      - name: Set up the repository
        shell: | 
                 yum install -y yum-utils
                 yum-config-manager \
                 --add-repo \
                 https://download.docker.com/linux/centos/docker-ce.repo
      - name: Install Docker Engine
        shell: "yum install -y docker-ce docker-ce-cli containerd.io"
        
      - name: Cloning the repo
        shell: "cd /home/stuti && git clone https://github.com/sparsh27/projCert.git"
        
      - name: Building Image
        shell: "docker build -t test /home/stuti/projCert/"
        
      - name: Running the container
        block:
        
        - name: Running the container
          shell: "docker run -itd -p 8000:80 test"
          register: run_container
          
        - debug:
             var: "{{ run_container }}.stdout"
             
        
          
        - name: Verifying whether container is running or not
          fail:
            msg: Docker container didn't ran successfully
          when: 
